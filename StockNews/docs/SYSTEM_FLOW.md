# StockNews System Flow

**ë¬¸ì„œ ë²„ì „:** 1.0
**ì‘ì„±ì¼:** 2026-02-21
**ìƒíƒœ:** Production (Phase 1-3 ì™„ë£Œ)

---

## ëª©ì°¨

1. [Overview](#1-overview)
2. [Data Collection Flow](#2-data-collection-flow)
3. [Processing Flow](#3-processing-flow)
4. [Scoring Flow](#4-scoring-flow)
5. [Distribution Flow](#5-distribution-flow)
6. [ML Pipeline Flow](#6-ml-pipeline-flow)
7. [Frontend Interaction Flow](#7-frontend-interaction-flow)

---

## 1. Overview

### 1.1 ì „ì²´ ì‹œìŠ¤í…œ íë¦„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     External News Sources                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Naver    â”‚  â”‚    DART    â”‚  â”‚  Finnhub   â”‚  â”‚   NewsAPI   â”‚  â”‚
â”‚  â”‚  Finance   â”‚  â”‚   (ê³µì‹œ)    â”‚  â”‚   (US)     â”‚  â”‚   (US)      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                â”‚                â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Collection Layer (APScheduler)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  KR Collector   â”‚  â”‚ DART Collector  â”‚  â”‚  US Collector    â”‚   â”‚
â”‚  â”‚   (1ë¶„ ì£¼ê¸°)     â”‚  â”‚   (5ë¶„ ì£¼ê¸°)     â”‚  â”‚   (3ë¶„ ì£¼ê¸°)      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                    â”‚                    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Processing Pipeline                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. Dedup    â”‚â†’ â”‚ 2. Stock     â”‚â†’ â”‚ 3. Article Scraping    â”‚ â”‚
â”‚  â”‚  (URL/Title) â”‚  â”‚    Mapping   â”‚  â”‚    (Body Content)      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                  â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  4. Parallel LLM Analysis (10 workers, ThreadPoolExecutor)   â”‚  â”‚
â”‚  â”‚     â€¢ Sentiment (Claude Sonnet 4, -1.0~1.0)                  â”‚  â”‚
â”‚  â”‚     â€¢ Theme Classification (Claude Opus, LLM or keyword)      â”‚  â”‚
â”‚  â”‚     â€¢ Summary (Claude Opus, title+body â†’ ìš”ì•½)                â”‚  â”‚
â”‚  â”‚     â€¢ Cross-market Impact (USë‰´ìŠ¤ â†’ KRì˜í–¥ ë¶„ì„)              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Scoring Engine                                â”‚
â”‚  News Score = RecencyÃ—0.4 + FrequencyÃ—0.3 +                        â”‚
â”‚               SentimentÃ—0.2 + DisclosureÃ—0.1                        â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Recency      â”‚  â”‚  Frequency    â”‚  â”‚  Sentiment          â”‚  â”‚
â”‚  â”‚  (24h ë°˜ê°ê¸°) â”‚  â”‚  (max 50ê±´)   â”‚  â”‚  (-1.0~1.0â†’0~100)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Disclosure Bonus: ê³µì‹œ=100, ì¼ë°˜=0                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Layer (PostgreSQL + Redis)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ news_event   â”‚  â”‚ theme_       â”‚  â”‚ prediction_result      â”‚   â”‚
â”‚  â”‚ (ê°œë³„ ë‰´ìŠ¤)   â”‚  â”‚ strength     â”‚  â”‚ (ML ì˜ˆì¸¡)              â”‚   â”‚
â”‚  â”‚              â”‚  â”‚ (í…Œë§ˆ ì§‘ê³„)   â”‚  â”‚                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  Redis: Cache (1-5ë¶„ TTL) + Pub/Sub (breaking_news ì±„ë„)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚                          â”‚
                       â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REST API + WebSocket            â”‚  â”‚  Redis Pub/Sub              â”‚
â”‚  (FastAPI, Port 8001)            â”‚  â”‚  (StockAgent Integration)   â”‚
â”‚  â€¢ /api/v1/news/*                â”‚  â”‚  Channel: breaking_news     â”‚
â”‚  â€¢ /api/v1/stocks/*              â”‚  â”‚  Threshold: score >= 80     â”‚
â”‚  â€¢ /api/v1/themes/*              â”‚  â”‚                             â”‚
â”‚  â€¢ /api/v1/prediction/*          â”‚  â”‚                             â”‚
â”‚  â€¢ /ws/news (WebSocket)          â”‚  â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                     â”‚
           â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend (React)        â”‚         â”‚  StockAgent                 â”‚
â”‚  â€¢ Dashboard             â”‚         â”‚  â€¢ Buy Signal Decision      â”‚
â”‚  â€¢ Stock Detail          â”‚         â”‚  â€¢ Breaking News Alert      â”‚
â”‚  â€¢ Theme Analysis        â”‚         â”‚  â€¢ Redis Subscriber         â”‚
â”‚  â€¢ Prediction View       â”‚         â”‚                             â”‚
â”‚  â€¢ Verification (Advan)  â”‚         â”‚                             â”‚
â”‚  â€¢ ì˜ˆì¸¡ ë¹„êµ              â”‚         â”‚                             â”‚
â”‚  â€¢ Real-time WebSocket   â”‚         â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ê°„ ë°ì´í„° íë¦„

**ìˆœì°¨ ì²˜ë¦¬ ë‹¨ê³„:**

1. **Collection** â€” ì™¸ë¶€ ì†ŒìŠ¤ì—ì„œ Raw Items ìˆ˜ì§‘
2. **Deduplication** â€” URL/Title ê¸°ë°˜ ì¤‘ë³µ ì œê±°
3. **Stock Mapping** â€” ì œëª©ì—ì„œ ì¢…ëª© ì½”ë“œ ì¶”ì¶œ
4. **Content Scraping** â€” ê¸°ì‚¬ ë³¸ë¬¸ ìŠ¤í¬ë˜í•‘ (ë¹„ë™ê¸° ë°°ì¹˜)
5. **LLM Analysis** â€” ë³‘ë ¬ ë¶„ì„ (ê°ì„±/í…Œë§ˆ/ìš”ì•½/ì˜í–¥)
6. **Scoring** â€” 4ê°€ì§€ ìš”ì†Œ ê°€ì¤‘í•© ê³„ì‚°
7. **DB Storage** â€” news_event í…Œì´ë¸” ì €ì¥
8. **Distribution** â€” Redis Pub/Sub (score>=80) + WebSocket ë¸Œë¡œë“œìºìŠ¤íŠ¸

**ë³‘ë ¬ ì²˜ë¦¬:**
- LLM ë¶„ì„: ThreadPoolExecutor (10 workers)
- Article Scraping: asyncio ë°°ì¹˜ ì²˜ë¦¬
- Frontend API: TanStack Query ë³‘ë ¬ fetch

---

## 2. Data Collection Flow

### 2.1 ë‰´ìŠ¤ ìˆ˜ì§‘ í”„ë¡œì„¸ìŠ¤

```
APScheduler (ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ì¼€ì¤„ëŸ¬)
    â”‚
    â”œâ”€â†’ KR Collector (1ë¶„ ì£¼ê¸°, cron: */1 * * * *)
    â”‚     â”‚
    â”‚     â”œâ”€â†’ Naver Finance (requests + BeautifulSoup)
    â”‚     â”‚     - URL: https://finance.naver.com/news/
    â”‚     â”‚     - íŒŒì‹±: ì œëª©, ë§í¬, ë‚ ì§œ
    â”‚     â”‚     - Rate Limit: ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ (ë¹„ê³µì‹ í¬ë¡¤ë§)
    â”‚     â”‚
    â”‚     â””â”€â†’ RSS Feeds (feedparser)
    â”‚           - ì—¬ëŸ¬ RSS ì†ŒìŠ¤ ë³‘í•©
    â”‚           - ì¤‘ë³µ ì œê±° ì¤€ë¹„
    â”‚
    â”œâ”€â†’ DART Collector (5ë¶„ ì£¼ê¸°, cron: */5 * * * *)
    â”‚     â”‚
    â”‚     â””â”€â†’ DART Open API (REST)
    â”‚           - URL: https://opendart.fss.or.kr/api/...
    â”‚           - API Key: í™˜ê²½ë³€ìˆ˜ (DART_API_KEY)
    â”‚           - Rate Limit: 10,000 req/day
    â”‚           - ì‘ë‹µ: JSON (ê³µì‹œ ì œëª©, ì¢…ëª©ì½”ë“œ, ë‚ ì§œ)
    â”‚           - is_disclosure=True í”Œë˜ê·¸ ì„¤ì •
    â”‚
    â””â”€â†’ US Collector (3ë¶„ ì£¼ê¸°, cron: */3 * * * *)
          â”‚
          â”œâ”€â†’ Finnhub API (httpx)
          â”‚     - URL: https://finnhub.io/api/v1/news
          â”‚     - API Key: í™˜ê²½ë³€ìˆ˜ (FINNHUB_API_KEY)
          â”‚     - Rate Limit: 60 req/min (free tier)
          â”‚
          â””â”€â†’ NewsAPI (httpx)
                - URL: https://newsapi.org/v2/everything
                - API Key: í™˜ê²½ë³€ìˆ˜ (NEWSAPI_API_KEY)
                - Rate Limit: 100 req/day (free tier)
```

**ìˆ˜ì§‘ ë°ì´í„° í¬ë§· (Raw Item):**
```python
{
    "title": "ì‚¼ì„±ì „ì ì‹¤ì  ë°œí‘œ",
    "source_url": "https://finance.naver.com/news/...",
    "source": "naver",
    "published_at": "2026-02-21T09:00:00Z",  # ISO 8601
    "is_disclosure": False,
    "market": "KR",  # KR or US
    "stock_code": "",  # ë¹ˆ ê°’ â†’ íŒŒì´í”„ë¼ì¸ì—ì„œ ë§¤í•‘
    "stock_name": ""
}
```

### 2.2 ìŠ¤ì¼€ì¤„ëŸ¬ ë™ì‘

**APScheduler BackgroundScheduler:**
```python
# app/collectors/scheduler.py

scheduler = BackgroundScheduler(timezone="Asia/Seoul")

# KR: 1ë¶„ë§ˆë‹¤
scheduler.add_job(
    collect_kr_news,
    trigger="cron",
    minute="*/1",
    id="kr_collector",
    replace_existing=True
)

# DART: 5ë¶„ë§ˆë‹¤
scheduler.add_job(
    collect_dart,
    trigger="cron",
    minute="*/5",
    id="dart_collector",
    replace_existing=True
)

# US: 3ë¶„ë§ˆë‹¤
scheduler.add_job(
    collect_us_news,
    trigger="cron",
    minute="*/3",
    id="us_collector",
    replace_existing=True
)

scheduler.start()
```

**ì‹¤í–‰ íë¦„:**
```
scheduler.start() (main.py ì•± ì‹œì‘ ì‹œ)
    â†“
ê° Collector í•¨ìˆ˜ ì‹¤í–‰
    â†“
Raw Items ìˆ˜ì§‘ (list[dict])
    â†“
Pipeline í˜¸ì¶œ: process_collected_items(db, items, market)
    â†“
ë¡œê¹… í›„ ì¢…ë£Œ (ë‹¤ìŒ ìŠ¤ì¼€ì¤„ê¹Œì§€ ëŒ€ê¸°)
```

### 2.3 ì™¸ë¶€ API í˜¸ì¶œ íŒ¨í„´

**Retry Logic (httpx):**
```python
import httpx

async def fetch_with_retry(url: str, max_retries: int = 3):
    for attempt in range(max_retries):
        try:
            async with httpx.AsyncClient(timeout=10.0) as client:
                response = await client.get(url)
                response.raise_for_status()
                return response.json()
        except httpx.HTTPStatusError as e:
            if e.response.status_code == 429:  # Rate limit
                await asyncio.sleep(2 ** attempt)  # Exponential backoff
            else:
                raise
    raise Exception("Max retries exceeded")
```

---

## 3. Processing Flow

### 3.1 íŒŒì´í”„ë¼ì¸ ì „ì²´ íë¦„

```
Raw Items (ìˆ˜ì§‘ê¸° ì¶œë ¥)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Deduplication (app/processing/dedup.py)         â”‚
â”‚     â€¢ DB ì¡°íšŒ: SELECT source_url FROM news_event    â”‚
â”‚     â€¢ ì¤‘ë³µ ì œê±°: source_url ì´ë¯¸ ì¡´ì¬ â†’ skip         â”‚
â”‚     â€¢ ê²°ê³¼: unique_items                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Stock Mapping                                    â”‚
â”‚     â€¢ KR: extract_stock_codes(title)                â”‚
â”‚       - "ì‚¼ì„±ì „ì" â†’ "005930"                        â”‚
â”‚       - Regex + ì¢…ëª©ì‚¬ì „ (KOSPI 200)                 â”‚
â”‚     â€¢ US: extract_tickers_from_text(title)          â”‚
â”‚       - "Apple" â†’ "AAPL"                            â”‚
â”‚       - Ticker regex pattern                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Article Scraping (app/processing/article_scraper)â”‚
â”‚     â€¢ asyncio ë°°ì¹˜ ìŠ¤í¬ë˜í•‘                           â”‚
â”‚     â€¢ URL â†’ body ë§¤í•‘ (dict[str, str | None])       â”‚
â”‚     â€¢ httpx + BeautifulSoup                         â”‚
â”‚     â€¢ Timeout: 5ì´ˆ/article                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Parallel LLM Analysis (10 workers)              â”‚
â”‚     ThreadPoolExecutor:                             â”‚
â”‚       _analyze_single(title, body, market)          â”‚
â”‚         â”œâ”€â†’ Sentiment Analysis (Sonnet 4)          â”‚
â”‚         â”‚     Input: title + body                   â”‚
â”‚         â”‚     Output: {sentiment, score, confidence}â”‚
â”‚         â”‚                                            â”‚
â”‚         â”œâ”€â†’ Theme Classification (Opus)             â”‚
â”‚         â”‚     Input: title + body                   â”‚
â”‚         â”‚     Output: ["AI", "ë°˜ë„ì²´", ...]          â”‚
â”‚         â”‚     Fallback: í‚¤ì›Œë“œ ê¸°ë°˜ ë¶„ë¥˜             â”‚
â”‚         â”‚                                            â”‚
â”‚         â”œâ”€â†’ News Summary (Opus)                     â”‚
â”‚         â”‚     Input: title + body                   â”‚
â”‚         â”‚     Output: í•œê¸€ ìš”ì•½ (2-3ë¬¸ì¥)            â”‚
â”‚         â”‚                                            â”‚
â”‚         â””â”€â†’ Cross-market Analysis (USë‰´ìŠ¤ë§Œ)        â”‚
â”‚               Input: title + body                   â”‚
â”‚               Output: ["AI", "ë°˜ë„ì²´"] (KR ì˜í–¥ í…Œë§ˆ)â”‚
â”‚                                                      â”‚
â”‚     Progress logging: 50ê±´ë§ˆë‹¤ ì§„í–‰ë¥  ì¶œë ¥           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. DB Insert + Redis Pub/Sub                       â”‚
â”‚     â€¢ NewsEvent ê°ì²´ ìƒì„±                            â”‚
â”‚     â€¢ db.add(event) + db.flush()                    â”‚
â”‚     â€¢ IF score >= 80: publish_breaking_news()       â”‚
â”‚     â€¢ db.commit() (ë°°ì¹˜ ì»¤ë°‹)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ì¤‘ë³µ ì œê±° ë¡œì§

**Deduplication (app/processing/dedup.py):**
```python
def deduplicate(db: Session, items: list[dict]) -> list[dict]:
    """source_url ê¸°ë°˜ ì¤‘ë³µ ì œê±°."""
    urls = [item["source_url"] for item in items if item.get("source_url")]

    # DBì—ì„œ ê¸°ì¡´ URL ì¡°íšŒ
    existing_urls = db.query(NewsEvent.source_url)\
        .filter(NewsEvent.source_url.in_(urls))\
        .all()
    existing_set = {url[0] for url in existing_urls}

    # ì¤‘ë³µ ì œê±°
    unique = [item for item in items
              if item.get("source_url") not in existing_set]

    return unique
```

**ì¤‘ë³µ íŒì • ê¸°ì¤€:**
1. `source_url`ì´ DBì— ì¡´ì¬ â†’ ì¤‘ë³µ (skip)
2. `source_url`ì´ None â†’ ì œëª© ìœ ì‚¬ë„ ì²´í¬ (ë¯¸êµ¬í˜„, í–¥í›„ ê°œì„ )
3. ê³ ìœ  ì œì•½: `UNIQUE INDEX ix_news_event_source_url`

### 3.3 ì¢…ëª© ë§¤í•‘

**í•œêµ­ ì¢…ëª© (app/processing/stock_mapper.py):**
```python
# ì¢…ëª© ì‚¬ì „ (KOSPI 200)
STOCK_DICT = {
    "ì‚¼ì„±ì „ì": "005930",
    "SKí•˜ì´ë‹‰ìŠ¤": "000660",
    "NAVER": "035420",
    # ... 200ê°œ
}

def extract_stock_codes(text: str) -> list[str]:
    """ì œëª©ì—ì„œ ì¢…ëª© ì½”ë“œ ì¶”ì¶œ."""
    codes = []
    for name, code in STOCK_DICT.items():
        if name in text:
            codes.append(code)
    return codes
```

**ë¯¸êµ­ ì¢…ëª© (app/processing/us_stock_mapper.py):**
```python
import re

TICKER_PATTERN = r'\b[A-Z]{1,5}\b'  # 1-5ì ëŒ€ë¬¸ì

def extract_tickers_from_text(text: str) -> list[str]:
    """ì œëª©ì—ì„œ í‹°ì»¤ ì¶”ì¶œ."""
    matches = re.findall(TICKER_PATTERN, text)
    # í•„í„°ë§: ì‹¤ì œ í‹°ì»¤ì¸ì§€ ê²€ì¦ (S&P 500 ì‚¬ì „)
    return [m for m in matches if m in SP500_TICKERS]
```

### 3.4 ê°ì„± ë¶„ì„

**LLM ê¸°ë°˜ ê°ì„± ë¶„ì„ (app/processing/sentiment.py):**
```python
def analyze_sentiment(title: str, body: str | None) -> dict:
    """AWS Bedrock Claude Sonnet 4 í˜¸ì¶œ."""
    prompt = f"""
ë‹¤ìŒ ë‰´ìŠ¤ì˜ ê°ì„±ì„ ë¶„ì„í•˜ì„¸ìš”.

ì œëª©: {title}
ë³¸ë¬¸: {body[:500] if body else "ì—†ìŒ"}

ì¶œë ¥ í˜•ì‹ (JSON):
{{
    "sentiment": "positive" | "neutral" | "negative",
    "score": -1.0 ~ 1.0,
    "confidence": 0.0 ~ 1.0
}}
"""

    response = bedrock_client.invoke_model(
        modelId="us.anthropic.claude-sonnet-4-20250514-v1:0",
        body=json.dumps({"prompt": prompt, ...})
    )

    result = json.loads(response["body"].read())
    return result
```

**ì¶œë ¥ ì˜ˆì‹œ:**
```json
{
    "sentiment": "positive",
    "score": 0.75,
    "confidence": 0.82
}
```

### 3.5 í…Œë§ˆ ë¶„ë¥˜

**LLM ê¸°ë°˜ (app/processing/llm_theme_classifier.py):**
```python
def classify_theme_llm(title: str, body: str | None, model_id: str) -> list[str]:
    """Claude Opus í˜¸ì¶œë¡œ í…Œë§ˆ ë¶„ë¥˜."""
    prompt = f"""
ë‹¤ìŒ ë‰´ìŠ¤ë¥¼ ë¶„ì„í•˜ì—¬ ê´€ë ¨ í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”.

ì œëª©: {title}
ë³¸ë¬¸: {body[:1000] if body else "ì—†ìŒ"}

ê°€ëŠ¥í•œ í…Œë§ˆ:
- AI (ì¸ê³µì§€ëŠ¥, ë¨¸ì‹ ëŸ¬ë‹, ChatGPT ë“±)
- ë°˜ë„ì²´ (ì¹©, ì›¨ì´í¼, íŒŒìš´ë“œë¦¬ ë“±)
- 2ì°¨ì „ì§€ (ë°°í„°ë¦¬, ì „ê¸°ì°¨, ESS ë“±)
- ë°”ì´ì˜¤ (ì œì•½, í—¬ìŠ¤ì¼€ì–´, ì„ìƒ ë“±)
- ê¸ˆìœµ (ì€í–‰, ì¦ê¶Œ, í•€í…Œí¬ ë“±)

ì¶œë ¥: JSON ë°°ì—´ (ì˜ˆ: ["AI", "ë°˜ë„ì²´"])
"""

    response = bedrock_client.invoke_model(modelId=model_id, ...)
    themes = json.loads(response)
    return themes
```

**í‚¤ì›Œë“œ Fallback (app/processing/theme_classifier.py):**
```python
THEME_KEYWORDS = {
    "AI": ["ì¸ê³µì§€ëŠ¥", "AI", "ChatGPT", "ë¨¸ì‹ ëŸ¬ë‹"],
    "ë°˜ë„ì²´": ["ë°˜ë„ì²´", "ì¹©", "ì›¨ì´í¼", "TSMC"],
    "2ì°¨ì „ì§€": ["2ì°¨ì „ì§€", "ë°°í„°ë¦¬", "ì „ê¸°ì°¨", "ë¦¬íŠ¬"],
    # ...
}

def classify_theme(text: str) -> list[str]:
    """í‚¤ì›Œë“œ ê¸°ë°˜ í…Œë§ˆ ë¶„ë¥˜."""
    themes = []
    for theme_name, keywords in THEME_KEYWORDS.items():
        if any(kw in text for kw in keywords):
            themes.append(theme_name)
    return themes[:3]  # ìµœëŒ€ 3ê°œ
```

---

## 4. Scoring Flow

### 4.1 ìŠ¤ì½”ì–´ ê³„ì‚° ë¡œì§

**4ê°€ì§€ ìš”ì†Œ (app/scoring/engine.py):**

```
News Score = RecencyÃ—0.4 + FrequencyÃ—0.3 + SentimentÃ—0.2 + DisclosureÃ—0.1

ê° ìš”ì†ŒëŠ” 0-100 ë²”ìœ„ë¡œ ì •ê·œí™”
```

**1) Recency (ìµœì‹ ì„±, 0-100):**
```python
def calc_recency(published_at: datetime) -> float:
    """ì§€ìˆ˜ ê°ì‡  ëª¨ë¸: score = 100 * 2^(-hours / half_life)"""
    delta_hours = (now - published_at).total_seconds() / 3600.0
    score = 100.0 * math.pow(2, -delta_hours / 24.0)  # ë°˜ê°ê¸° 24ì‹œê°„
    return round(max(0.0, min(100.0, score)), 2)
```

**ì˜ˆì‹œ:**
- 1ì‹œê°„ ì „ ë‰´ìŠ¤: 97.2
- 12ì‹œê°„ ì „: 70.7
- 24ì‹œê°„ ì „: 50.0
- 48ì‹œê°„ ì „: 25.0

**2) Frequency (ë¹ˆë„, 0-100):**
```python
def calc_frequency(news_count: int) -> float:
    """ì„ í˜• ìŠ¤ì¼€ì¼ë§: min(100, count / 50 * 100)"""
    score = (news_count / 50) * 100.0
    return round(min(100.0, score), 2)
```

**ì˜ˆì‹œ:**
- 1ê±´: 2.0
- 10ê±´: 20.0
- 25ê±´: 50.0
- 50ê±´ ì´ìƒ: 100.0

**3) Sentiment (ê°ì„±, 0-100):**
```python
def calc_sentiment_score(sentiment: str, score: float) -> float:
    """ê°ì„± ì ìˆ˜ -1.0~1.0 â†’ 0~100 ë³€í™˜."""
    normalized = (score + 1.0) * 50.0
    return round(max(0.0, min(100.0, normalized)), 2)
```

**ì˜ˆì‹œ:**
- score = 1.0 (ë§¤ìš° ê¸ì •): 100.0
- score = 0.5: 75.0
- score = 0.0 (ì¤‘ë¦½): 50.0
- score = -0.5: 25.0
- score = -1.0 (ë§¤ìš° ë¶€ì •): 0.0

**4) Disclosure (ê³µì‹œ ê°€ì‚°ì , 0 or 100):**
```python
def calc_disclosure(is_disclosure: bool) -> float:
    """ê³µì‹œ ì—¬ë¶€."""
    return 100.0 if is_disclosure else 0.0
```

### 4.2 ìµœì¢… ì ìˆ˜ ê³„ì‚°

```python
def calc_news_score(
    recency: float,
    frequency: float,
    sentiment: float,
    disclosure: float,
) -> float:
    """ê°€ì¤‘í•©."""
    score = (
        recency * 0.4 +
        frequency * 0.3 +
        sentiment * 0.2 +
        disclosure * 0.1
    )
    return round(max(0.0, min(100.0, score)), 2)
```

**ì˜ˆì‹œ ì‹œë‚˜ë¦¬ì˜¤:**

| ì¡°ê±´ | Recency | Frequency | Sentiment | Disclosure | ìµœì¢… |
|------|---------|-----------|-----------|------------|------|
| ìµœì‹  ê¸ì • ë‰´ìŠ¤ ë§ìŒ | 97.2 (1ì‹œê°„ ì „) | 60.0 (30ê±´) | 85.0 (0.7) | 0.0 | **74.9** |
| ê³µì‹œ + ê¸ì • | 70.0 (12ì‹œê°„ ì „) | 10.0 (5ê±´) | 90.0 (0.8) | 100.0 | **59.0** |
| ì˜¤ë˜ëœ ë¶€ì • | 25.0 (48ì‹œê°„ ì „) | 4.0 (2ê±´) | 15.0 (-0.7) | 0.0 | **14.2** |

### 4.3 ì§‘ê³„ (Aggregation)

**ì¢…ëª©ë³„ ì§‘ê³„ (app/scoring/aggregator.py):**
```python
def aggregate_by_stock(db: Session, market: str, hours: int = 24) -> list[dict]:
    """ìµœê·¼ Nì‹œê°„ ë‚´ ì¢…ëª©ë³„ ë‰´ìŠ¤ ì§‘ê³„."""
    cutoff = datetime.now(UTC) - timedelta(hours=hours)

    results = db.query(
        NewsEvent.stock_code,
        func.count(NewsEvent.id).label("news_count"),
        func.avg(NewsEvent.news_score).label("avg_score"),
        func.avg(NewsEvent.sentiment_score).label("avg_sentiment"),
    ).filter(
        NewsEvent.market == market,
        NewsEvent.published_at >= cutoff
    ).group_by(NewsEvent.stock_code).all()

    return results
```

**í…Œë§ˆë³„ ì§‘ê³„:**
```python
def aggregate_by_theme(db: Session, market: str, date: str) -> list[dict]:
    """ì¼ë³„ í…Œë§ˆ ê°•ë„ ê³„ì‚° í›„ theme_strength í…Œì´ë¸” ì €ì¥."""
    results = db.query(
        NewsEvent.theme,
        func.count(NewsEvent.id).label("news_count"),
        func.avg(NewsEvent.sentiment_score).label("avg_sentiment"),
    ).filter(
        NewsEvent.market == market,
        func.date(NewsEvent.published_at) == date
    ).group_by(NewsEvent.theme).all()

    for row in results:
        strength_score = calc_theme_strength(row.news_count, row.avg_sentiment)
        # DB insert to theme_strength

    return results
```

---

## 5. Distribution Flow

### 5.1 REST API ì œê³µ

**Endpoint í˜¸ì¶œ íë¦„:**

```
Client (Frontend or StockAgent)
    â†“
GET /api/v1/news/score?stock=005930&market=KR
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FastAPI Route Handler                  â”‚
â”‚  (app/api/news.py)                      â”‚
â”‚                                          â”‚
â”‚  @limiter.limit("60/minute")            â”‚
â”‚  async def get_news_score(              â”‚
â”‚      stock: str,                         â”‚
â”‚      market: str = "KR"                  â”‚
â”‚  ):                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis Cache Check                      â”‚
â”‚  cache_key = f"score:{market}:{stock}"  â”‚
â”‚                                          â”‚
â”‚  IF cached:                              â”‚
â”‚      return cached (1ë¶„ TTL)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DB Query                                â”‚
â”‚  SELECT * FROM news_event               â”‚
â”‚  WHERE stock_code = ? AND market = ?    â”‚
â”‚  ORDER BY published_at DESC             â”‚
â”‚  LIMIT 100                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Aggregation                             â”‚
â”‚  â€¢ Calculate avg score                   â”‚
â”‚  â€¢ Count news                            â”‚
â”‚  â€¢ Identify top themes                   â”‚
â”‚  â€¢ Determine sentiment                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pydantic Schema Validation              â”‚
â”‚  NewsScoreResponse(**data)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis Cache Store                       â”‚
â”‚  redis.setex(cache_key, 60, json)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JSON Response                           â”‚
â”‚  {                                       â”‚
â”‚    "stock_code": "005930",              â”‚
â”‚    "news_score": 82.5,                  â”‚
â”‚    "sentiment": "positive",             â”‚
â”‚    "issue_count": 5,                    â”‚
â”‚    ...                                   â”‚
â”‚  }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 WebSocket ë¸Œë¡œë“œìºìŠ¤íŠ¸

**ì‹¤ì‹œê°„ ë‰´ìŠ¤ ìŠ¤íŠ¸ë¦¼ (app/api/websocket.py):**

```
WebSocket Client (Frontend)
    â†“
WS /ws/news (connection request)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WebSocket Handler                     â”‚
â”‚  â€¢ websocket.accept()                  â”‚
â”‚  â€¢ _add_connection(ws)                 â”‚
â”‚  â€¢ Send welcome message                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis Subscriber Start (ì²« í´ë¼ì´ì–¸íŠ¸) â”‚
â”‚  â€¢ async_redis.pubsub()                â”‚
â”‚  â€¢ subscribe("news_breaking_kr")       â”‚
â”‚  â€¢ subscribe("news_breaking_us")       â”‚
â”‚  â€¢ asyncio.create_task(listen_loop)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Message Listen Loop                    â”‚
â”‚  async for message in pubsub.listen():  â”‚
â”‚      IF message["type"] == "message":   â”‚
â”‚          json_data = parse(message)     â”‚
â”‚          broadcast(json_data)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Broadcast to All Clients               â”‚
â”‚  for ws in active_connections:          â”‚
â”‚      await ws.send_json(data)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
WebSocket Client receives message
```

**Message Format:**
```json
{
    "type": "breaking_news",
    "data": {
        "stock_code": "035420",
        "stock_name": "NAVER",
        "title": "NAVER, AI íˆ¬ì ë°œí‘œ",
        "news_score": 90.0,
        "theme": "AI",
        "sentiment": 0.8,
        "market": "KR",
        "published_at": "2026-02-21T10:00:00Z"
    }
}
```

### 5.3 Redis Pub/Sub

**ì†ë³´ ë°œí–‰ ë¡œì§ (app/core/pubsub.py):**

```
NewsEvent ì €ì¥ í›„
    â†“
IF news_score >= 80.0:
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  publish_news_event()                  â”‚
â”‚  â€¢ Validate with Pydantic schema        â”‚
â”‚  â€¢ Build BreakingNewsMessage            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis PUBLISH                          â”‚
â”‚  channel = "news_breaking_kr" (or _us)  â”‚
â”‚  payload = JSON message                 â”‚
â”‚                                          â”‚
â”‚  redis.publish(channel, payload)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Subscribers Receive                    â”‚
â”‚  â€¢ WebSocket clients (Frontend)         â”‚
â”‚  â€¢ StockAgent (backend/src/core/        â”‚
â”‚    news_subscriber.py)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Channel Naming:**
- `news_breaking_kr` â€” í•œêµ­ ì†ë³´
- `news_breaking_us` â€” ë¯¸êµ­ ì†ë³´

**Threshold:**
```python
BREAKING_THRESHOLD = 80.0  # 80ì  ì´ìƒë§Œ ë°œí–‰
```

---

## 6. ML Pipeline Flow

### 6.1 Feature Extraction

```
Historical NewsEvent Data (30ì¼ ~ 6ê°œì›”)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Feature Engineering                    â”‚
â”‚  (app/processing/feature_engineer.py)  â”‚
â”‚                                          â”‚
â”‚  FOR EACH (stock, date):                â”‚
â”‚    â€¢ news_score_avg                     â”‚
â”‚    â€¢ news_score_max                     â”‚
â”‚    â€¢ news_score_min                     â”‚
â”‚    â€¢ sentiment_score_avg                â”‚
â”‚    â€¢ news_count                         â”‚
â”‚    â€¢ disclosure_count                   â”‚
â”‚    â€¢ theme_AI (count)                   â”‚
â”‚    â€¢ theme_semiconductor (count)        â”‚
â”‚    â€¢ theme_battery (count)              â”‚
â”‚    â€¢ recency_weighted_score             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
Feature Vector: [82.5, 95.0, 70.0, 0.65, 12, 1, 5, 7, 0, 88.3]
```

### 6.2 Model Training

```
Training Data (features + labels)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Label Generation (yfinance)            â”‚
â”‚  â€¢ Fetch next-day price change          â”‚
â”‚  â€¢ IF change > 1%: "up"                 â”‚
â”‚  â€¢ ELIF change < -1%: "down"            â”‚
â”‚  â€¢ ELSE: "neutral"                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Train/Test Split                       â”‚
â”‚  â€¢ Chronological split: 80/20           â”‚
â”‚  â€¢ Train: 2024-01 ~ 2024-10             â”‚
â”‚  â€¢ Test: 2024-11 ~ 2024-12              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  StandardScaler                         â”‚
â”‚  â€¢ Fit on train data                    â”‚
â”‚  â€¢ Transform train & test               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RandomForestClassifier                 â”‚
â”‚  â€¢ n_estimators=100                     â”‚
â”‚  â€¢ max_depth=10                         â”‚
â”‚  â€¢ class_weight='balanced'              â”‚
â”‚  â€¢ random_state=42                      â”‚
â”‚                                          â”‚
â”‚  model.fit(X_train, y_train)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Model Evaluation                       â”‚
â”‚  â€¢ Accuracy: 62% (KR), 58% (US)         â”‚
â”‚  â€¢ Precision/Recall                     â”‚
â”‚  â€¢ Feature Importance                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Model Serialization (joblib)           â”‚
â”‚  joblib.dump(model, "rf_model_KR.joblib")â”‚
â”‚  joblib.dump(scaler, "scaler_KR.joblib")â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 Prediction Generation

```
Real-time Request
GET /api/v1/prediction/stock?code=005930
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Load Model                             â”‚
â”‚  model = joblib.load("rf_model_KR.joblib")â”‚
â”‚  scaler = joblib.load("scaler_KR.joblib")â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Fetch Recent News (30 days)            â”‚
â”‚  SELECT * FROM news_event               â”‚
â”‚  WHERE stock_code = ? AND               â”‚
â”‚        published_at >= now() - 30 days  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Extract Features                       â”‚
â”‚  feature_vector = extract_features(news)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Model Inference                        â”‚
â”‚  X_scaled = scaler.transform([features])â”‚
â”‚  prediction = model.predict(X_scaled)   â”‚
â”‚  proba = model.predict_proba(X_scaled)  â”‚
â”‚                                          â”‚
â”‚  direction = prediction[0]  # "up"      â”‚
â”‚  confidence = max(proba[0])  # 0.72     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Save to prediction_result              â”‚
â”‚  INSERT INTO prediction_result (...)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
JSON Response:
{
    "stock_code": "005930",
    "direction": "up",
    "confidence": 0.72,
    "predicted_at": "2026-02-21T10:00:00Z"
}
```

### 6.4 Prediction Verification

```
Daily Scheduler (ë§¤ì¼ ì¥ ë§ˆê° í›„)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Verification Engine                    â”‚
â”‚  â€¢ Fetch predictions from 1 day ago     â”‚
â”‚  â€¢ Fetch actual price changes (yfinance)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Compare Prediction vs Actual           â”‚
â”‚  FOR EACH prediction:                   â”‚
â”‚    IF predicted == actual:              â”‚
â”‚        hit_count += 1                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Calculate Metrics                      â”‚
â”‚  â€¢ Accuracy = hits / total              â”‚
â”‚  â€¢ Per-direction precision/recall       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Save to daily_prediction_result        â”‚
â”‚  INSERT INTO daily_prediction_result    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Frontend Interaction Flow

### 7.1 API í˜¸ì¶œ íŒ¨í„´

**TanStack Query Pattern (src/hooks/useNewsScore.ts):**

```
Component Mount (DashboardPage)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  useQuery Hook                          â”‚
â”‚  const { data, isLoading } = useQuery({ â”‚
â”‚    queryKey: ["news", "score", stock],  â”‚
â”‚    queryFn: () => fetchNewsScore(stock) â”‚
â”‚    staleTime: 60000,  // 1ë¶„           â”‚
â”‚    refetchInterval: 60000               â”‚
â”‚  })                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Axios Request                          â”‚
â”‚  axios.get("/api/v1/news/score", {      â”‚
â”‚    params: { stock, market }            â”‚
â”‚  })                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
Backend API â†’ Response
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TanStack Query Cache Update            â”‚
â”‚  â€¢ Store in query cache                 â”‚
â”‚  â€¢ Trigger re-render                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
Component Re-renders with data
```

**ë³‘ë ¬ Fetch ì˜ˆì‹œ:**
```typescript
// src/pages/DashboardPage.tsx

// ë³‘ë ¬ í˜¸ì¶œ
const topNewsQuery = useQuery({
    queryKey: ["news", "top", market],
    queryFn: () => fetchTopNews(market)
});

const themeStrengthQuery = useQuery({
    queryKey: ["themes", "strength", market],
    queryFn: () => fetchThemeStrength(market)
});

const latestNewsQuery = useQuery({
    queryKey: ["news", "latest", market],
    queryFn: () => fetchLatestNews(market, 20)
});

// ëª¨ë‘ ë³‘ë ¬ë¡œ ì‹¤í–‰ë¨
```

### 7.2 WebSocket ì—°ê²° íë¦„

**useWebSocket Hook (src/hooks/useWebSocket.ts):**

```
Component Mount
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  useWebSocket()                         â”‚
â”‚  const ws = new WebSocket(              â”‚
â”‚    "ws://localhost:8001/ws/news"        â”‚
â”‚  )                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ws.onopen                              â”‚
â”‚  â€¢ Log "Connected"                      â”‚
â”‚  â€¢ Send subscribe message (optional)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ws.onmessage                           â”‚
â”‚  â€¢ Parse JSON                           â”‚
â”‚  â€¢ IF type === "breaking_news":         â”‚
â”‚      show toast notification            â”‚
â”‚      update news list                   â”‚
â”‚  â€¢ IF type === "ping":                  â”‚
â”‚      send pong response                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ws.onclose                             â”‚
â”‚  â€¢ Log "Disconnected"                   â”‚
â”‚  â€¢ Retry connection (exponential backoff)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Toast Notification:**
```typescript
// src/components/common/Toast.tsx

function showBreakingNews(data: BreakingNewsData) {
    toast.info(
        `ğŸš¨ ${data.stock_name} (${data.stock_code})
        ${data.title}
        Score: ${data.news_score}`,
        { autoClose: 10000 }
    );
}
```

### 7.3 ìƒíƒœ ê´€ë¦¬

**Query Cache Invalidation:**
```typescript
// After WebSocket message received
import { useQueryClient } from "@tanstack/react-query";

const queryClient = useQueryClient();

ws.onmessage = (event) => {
    const message = JSON.parse(event.data);

    if (message.type === "breaking_news") {
        // Invalidate related queries to refetch
        queryClient.invalidateQueries({
            queryKey: ["news", "top", message.data.market]
        });
        queryClient.invalidateQueries({
            queryKey: ["news", "score", message.data.stock_code]
        });
    }
};
```

### 7.4 í˜ì´ì§€ë³„ ë°ì´í„° íë¦„

**Dashboard Page:**
```
DashboardPage Mount
    â†“
State: selectedDate (default: today)
    â†“
Parallel Queries:
  â€¢ fetchTopNews(market, date)       â†’ NewsTopList (date-filtered)
  â€¢ fetchThemeStrength(market, date) â†’ ThemeStrengthList (date-filtered)
    â†“
Render:
  â€¢ TopStockCards (grid of top 10)
  â€¢ ThemeStrengthChart (bar chart)
  â€¢ NewsList (latest 20 items)
    â†“
WebSocket Updates:
  â€¢ Breaking news â†’ Toast + refetch
  â€¢ Score updates â†’ Update displayed scores
```

**Stock Detail Page:**
```
StockDetailPage Mount (/:stockCode)
    â†“
useParams() â†’ stockCode = "005930"
    â†“
Parallel Queries:
  â€¢ fetchStockTimeline(stockCode, 7)  â†’ Timeline data
  â€¢ fetchStockNews(stockCode, 50)     â†’ News list
  â€¢ fetchNewsScore(stockCode)         â†’ Current score
    â†“
Render:
  â€¢ Header (stock name + current score)
  â€¢ ScoreTimeline (line chart, 7 days)
  â€¢ SentimentPie (sentiment distribution)
  â€¢ NewsList (filtered by stock)
```

**Theme Analysis Page:**
```
ThemeAnalysisPage Mount
    â†“
State: selectedDate (default: today)
    â†“
fetchThemeStrength(market, date)
    â†“
Render:
  â€¢ ThemeStrengthChart (horizontal bar, no animation, color-coded by rise_index)
    â†“
User clicks theme (e.g., "AI")
    â†“
fetchStocksByTheme("AI")
    â†“
Render:
  â€¢ ThemeStockList (stocks related to AI theme)
  â€¢ Each stock: code, name, score, sentiment
```

**Verification Page (Advan ê¸°ë°˜):**
```
VerificationPage Mount
    â†“
State: selectedRunId (auto-select latest completed run)
    â†“
Queries:
  â€¢ useAdvanRuns({ market, status: 'completed' })  â†’ ì™„ë£Œëœ ì‹¤í–‰ ëª©ë¡
    â†“
useEffect: Auto-select latest run (ID ë‚´ë¦¼ì°¨ìˆœ)
    â†“
Parallel Queries (selectedRunId ê¸°ë°˜):
  â€¢ useAdvanRun(selectedRunId)          â†’ ì‹¤í–‰ ìƒì„¸ (predictions + labels + direction_stats)
  â€¢ useAdvanRunByStock(selectedRunId)   â†’ ì¢…ëª©ë³„ ê²°ê³¼
  â€¢ useAdvanRunByTheme(selectedRunId)   â†’ í…Œë§ˆë³„ ì •í™•ë„
    â†“
useMemo: Map Advan data to component formats
  â€¢ accuracyData: runDetail â†’ AccuracyResponse (direction stats 0-1â†’0-100 ë³€í™˜)
  â€¢ stockResults: predictions + labels â†’ DailyPredictionResult[] (Abstain ì œì™¸)
  â€¢ themeAccuracyData: byTheme â†’ ThemeAccuracy[]
    â†“
Render:
  â€¢ Run selector dropdown (completed runs)
  â€¢ Run info banner (name, date range, accuracy)
  â€¢ AccuracyOverviewCard (run-level accuracy)
  â€¢ StockResultsTable (ì¢…ëª©ë³„ ê²€ì¦ ê²°ê³¼)
  â€¢ ThemeAccuracyBreakdown (í…Œë§ˆë³„ ì •í™•ë„)
```

**ì˜ˆì¸¡ ë¹„êµ Page (SystemComparisonPage):**
```
SystemComparisonPage Mount
    â†“
Parallel Queries:
  â€¢ StockNews ì˜ˆì¸¡: useDailyResults(date, market)
  â€¢ Advan ì‹¤í–‰ ëª©ë¡: useAdvanRuns({ market, status: 'completed' })
    â†“
State: selectedRunId, compareRunId (ë‘ ì‹¤í–‰ ë¹„êµ ê°€ëŠ¥)
    â†“
Render:
  â€¢ StockNews ì˜ˆì¸¡ vs Advan ì˜ˆì¸¡ ë¹„êµ í…Œì´ë¸”
  â€¢ ì‹¤í–‰ ì„ íƒ ë“œë¡­ë‹¤ìš´ (v1/v2 ë¹„êµ)
  â€¢ ì¢…ëª©ë³„/í…Œë§ˆë³„ ì •í™•ë„ ë¹„êµ
```

---

## Document End

**ìµœì¢… ê²€ì¦ì¼:** 2026-02-22
**ê²€ì¦ í•­ëª©:**
- ì „ì²´ ì‹œìŠ¤í…œ íë¦„ ê²€ì¦ (ìˆ˜ì§‘ â†’ ì²˜ë¦¬ â†’ ë¶„ì„ â†’ ì €ì¥ â†’ ë°°í¬)
- ê° ì»´í¬ë„ŒíŠ¸ ê°„ ë°ì´í„° íë¦„ í™•ì¸
- API/WebSocket/Redis Pub-Sub í†µì‹  íŒ¨í„´ ê²€ì¦
- ML Pipeline ë™ì‘ í™•ì¸
- Frontend ìƒíƒœ ê´€ë¦¬ ë° ë Œë”ë§ íë¦„ ê²€ì¦
- Advan ì˜ˆì¸¡ ì‹œìŠ¤í…œ (ì´ë²¤íŠ¸ ì¶”ì¶œ â†’ íœ´ë¦¬ìŠ¤í‹± ì˜ˆì¸¡ â†’ ë¼ë²¨ë§ â†’ ê²€ì¦) íë¦„ í™•ì¸
- Verification í˜ì´ì§€ Advan ì—°ë™ í™•ì¸

**ê´€ë ¨ ë¬¸ì„œ:**
- `docs/StockNews-v1.0.md` â€” ì „ì²´ ì‹œìŠ¤í…œ ì„¤ê³„ì„œ
- `docs/ARCHITECTURE.md` â€” ì•„í‚¤í…ì²˜ ìƒì„¸ ë¬¸ì„œ
- `~/AgentDev/CLAUDE.md` â€” í¬ë¡œìŠ¤ í”„ë¡œì íŠ¸ í†µí•© ê°€ì´ë“œ
- `CLAUDE.md` â€” í”„ë¡œì íŠ¸ë³„ Claude ê°€ì´ë“œ
