# Fluentd configuration for StockNews log aggregation

<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

# Parse JSON logs from backend (structlog outputs JSON)
<filter stocknews.backend>
  @type parser
  key_name log
  reserve_data true
  <parse>
    @type json
    time_key timestamp
    time_format %Y-%m-%dT%H:%M:%S
  </parse>
</filter>

# Tag-based routing
<match stocknews.**>
  @type file
  path /fluentd/log/${tag}
  append true
  <format>
    @type json
  </format>
  <buffer tag>
    flush_interval 10s
    chunk_limit_size 1m
    retry_max_interval 30s
  </buffer>
</match>
