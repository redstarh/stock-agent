# StockAgent 개발 태스크 계획서

## (의존성 분석 + 병렬 실행 계획)

---

# 1. 태스크 전체 요약

| 구분 | 개수 | 범위 |
|------|------|------|
| Backend | 22 | B-1 ~ B-22 |
| Frontend | 14 | F-1 ~ F-14 |
| **총 태스크** | **36** | 3 Phase |

### TDD 원칙

모든 태스크는 **테스트 선행** 방식으로 진행한다.

```
[T-Bn] RED → [B-n] GREEN → REFACTOR → 완료
[T-Fn] RED → [F-n] GREEN → REFACTOR → 완료
```

테스트 상세 명세는 `TestAgent.md` 참조.

---

# 2. 의존성 그래프

```
B-1 (셋업) ─────────┬───────────────────┬─────────────────┐
                     │                   │                 │
                   B-2 (DB)           B-3 (인증)        B-11 (뉴스REST)
                   / | \              / | \                |
                  /  |  \            /  |  \             B-12 (뉴스Redis)
                 /   |   \       B-4  B-5  B-6             |
                /    |    \       |    |                    |
             B-9   B-14  B-19   B-7   |                    |
              |      |     |     |  \ |                    |
            B-16   B-15    |    B-10 B-8                   |
                           |     |    |                    |
                         B-20  B-13  B-18                  |
                           |   / |                         |
                         B-22  B-17                        |
                               B-21 ←─────────────────────┘
                                        (B-19 + B-13)

F-1 (셋업) → F-2 (Mock) → F-3~F-14 (모두 Mock으로 독립 개발 가능)
```

### API 엔드포인트 커버리지

v1.0 API Contract(섹션 8.2)에 정의된 모든 엔드포인트가 태스크에 매핑되어야 한다.
아래 3개 API 그룹은 독립 태스크 없이 **기존 태스크 범위에 포함**한다.

| API 엔드포인트 | 포함 태스크 | 근거 |
|----------------|-----------|------|
| `POST /system/start`, `POST /system/stop` | **B-9** (기본 API) | 시스템 제어는 health/account와 같은 기본 API 계층 |
| `GET/PUT /risk/config`, `POST /risk/emergency-sell` | **B-14** (Risk Management) | 리스크 로직과 API를 함께 구현 |
| `GET /scanner/top` | **B-10** (Opening Scanner) | 스캐너 로직과 API를 함께 구현 |

### 태스크 범위 보완 (Implicit Scope)

v1.0 기술 스택(섹션 4)과 운영 요구사항(섹션 14~15)에 명시되었으나
태스크 설명에 빠져 있는 항목들을 기존 태스크 범위에 포함한다.

| 누락 항목 | v1.0 출처 | 포함 태스크 | 구현 내용 |
|-----------|----------|-----------|----------|
| `config.py` (pydantic-settings) | 섹션 5 디렉토리 | **B-1** | 환경변수 로딩, .env 파일 구조, DB/Redis/키움 설정 |
| `main.py` (FastAPI 엔트리포인트) | 섹션 5 디렉토리 | **B-9** | app 생성, 라우터 등록, lifespan 이벤트 |
| `database.py` (DB 연결 관리) | 섹션 5 디렉토리 | **B-2** | 커넥션 풀, async session factory |
| Alembic 마이그레이션 | 섹션 4 (SQLAlchemy) | **B-2** | alembic init, 초기 마이그레이션 스크립트 |
| APScheduler (장 시간 스케줄링) | 섹션 4.1 기술스택 | **B-8** | 09:00 매매 시작, 15:30 매매 정지 스케줄 |
| API Rate Limit 관리 | 섹션 14 운영 안정성 | **B-3** | httpx 클라이언트 레벨 초당 호출 제한 (키움 5회/초) |
| 로깅 인프라 (로그 롤링) | 섹션 14 운영 안정성 | **B-1** | structlog/logging 설정, 일 단위 파일 롤링 |
| 네트워크 재시도 로직 | 섹션 14 운영 안정성 | **B-3** | exponential backoff, httpx retry transport |
| 보안 (API 키 관리) | 섹션 15 보완 사항 | **B-1** | .env 기반 secrets, 환경변수 분리 |
| `layout.tsx` + 네비게이션 | 섹션 5 디렉토리 | **F-1** | App Router 레이아웃, 사이드바/헤더 네비게이션 |
| 에러 핸들링 공통 구조 | 섹션 15 보완 사항 | **B-9** | FastAPI exception handler, 공통 에러 응답 스키마 |

---

# 3. 병렬 실행 레인

Backend와 Frontend는 **API Contract + MSW Mock** 기반으로 완전히 독립 병렬 개발이 가능하다.

```
Timeline ──────────────────────────────────────────────────────────►

Backend Lane ─────────────────────────────────────────────────────►
  Sprint 0 → Sprint 1 → Sprint 2 → Sprint 3 → Sprint 4 → Sprint 5 → Sprint 6

Frontend Lane ────────────────────────────────────────────────────►
  Sprint 0 → Sprint 1-F → Sprint 2-F → Sprint 3-F

통합 검증 ────────────────────────────────────────────────────────►
                              Integration-1      Integration-2     Integration-3
```

---

# 4. Sprint 계획

## Sprint 0: 프로젝트 부트스트랩

> 모든 개발의 시작점. Backend/Frontend 동시 셋업.

### 병렬 그룹

```
┌─────────────────────┐  ┌─────────────────────┐
│  B-1: Backend 셋업   │  │  F-1: Frontend 셋업  │
│  pyproject.toml      │  │  Next.js + TS        │
│  Docker Compose      │  │  TailwindCSS         │
│  pytest 설정          │  │  Jest 설정            │
└─────────────────────┘  └──────────┬────────────┘
                                    │
                          ┌─────────▼────────────┐
                          │  F-2: API Client+Mock │
                          │  fetch wrapper + MSW  │
                          └──────────────────────┘
```

| 순서 | ID | 태스크 | TDD 테스트 | 병렬 |
|------|-----|--------|-----------|------|
| 0-1 | B-1 | Backend 프로젝트 셋업 | T-B1 | **B-1 ∥ F-1** |

| 0-2 | F-1 | Frontend 프로젝트 셋업 | T-F1 | **B-1 ∥ F-1** |
| 0-3 | F-2 | API 클라이언트 + MSW Mock | T-F2 | F-1 완료 후 |

**완료 조건:** pytest 실행 가능, Next.js dev 서버 기동, MSW Mock 동작

---

## Sprint 1: 기반 모듈 (3 병렬)

> B-1 완료 후 시작. DB, 인증, 뉴스 클라이언트를 동시 개발.

### 병렬 그룹

```
              B-1 완료
           ┌─────┼─────────┐
           ▼     ▼         ▼
        ┌─────┐ ┌─────┐ ┌──────┐
        │ B-2 │ │ B-3 │ │ B-11 │
        │ DB  │ │인증  │ │뉴스  │
        └─────┘ └─────┘ └──────┘
```

| 순서 | ID | 태스크 | TDD 테스트 | 선행 | 병렬 |
|------|-----|--------|-----------|------|------|
| 1-1 | B-2 | DB 스키마 + ORM 모델 | T-B2 | B-1 | **B-2 ∥ B-3 ∥ B-11** |
| 1-2 | B-3 | 키움 인증 클라이언트 | T-B3 | B-1 | **B-2 ∥ B-3 ∥ B-11** |
| 1-3 | B-11 | StockNews REST 연동 | T-B11 | B-1 | **B-2 ∥ B-3 ∥ B-11** |

**완료 조건:** 4개 ORM 모델 정의, 토큰 발급 테스트 통과, 뉴스 점수 조회 테스트 통과

---

## Sprint 2: 클라이언트 확장 (최대 9 병렬)

> Sprint 1 완료 후. 키움 API 3개 클라이언트 + DB 의존 모듈 + 뉴스 Redis + Frontend UI.

### 병렬 그룹

```
B-3 완료                  B-2 완료              B-11 완료      F-2 완료
┌──┬──┬──┐            ┌────┬────┬────┐           │          ┌──┬──┬──┐
▼  ▼  ▼  │            ▼    ▼    ▼    │           ▼          ▼  ▼  ▼
B-4 B-5 B-6          B-9  B-14 B-19  │          B-12       F-3 F-4 F-5
시세 주문 계좌        API  리스크 학습  │         Redis구독
```

| 순서 | ID | 태스크 | TDD 테스트 | 선행 | 병렬 |
|------|-----|--------|-----------|------|------|
| 2-1 | B-4 | 키움 시세 클라이언트 | T-B4 | B-3 | **B-4 ∥ B-5 ∥ B-6** |
| 2-2 | B-5 | 키움 주문 클라이언트 | T-B5 | B-3 | **B-4 ∥ B-5 ∥ B-6** |
| 2-3 | B-6 | 키움 계좌 클라이언트 | T-B6 | B-3 | **B-4 ∥ B-5 ∥ B-6** |
| 2-4 | B-9 | FastAPI 기본 API + 시스템 제어 | T-B9 | B-2 | **B-9 ∥ B-14 ∥ B-19** |
| 2-5 | B-14 | Risk Management + Risk API | T-B14 | B-2 | **B-9 ∥ B-14 ∥ B-19** |
| 2-6 | B-19 | Learning DB | T-B19 | B-2 | **B-9 ∥ B-14 ∥ B-19** |
| 2-7 | B-12 | Redis 뉴스 구독 | T-B12 | B-11 | 독립 |
| 2-8 | F-3 | 인증 UI | T-F3 | F-2 (mock) | **F-3 ∥ F-4 ∥ F-5** |
| 2-9 | F-4 | 계좌 대시보드 | T-F4 | F-2 (mock) | **F-3 ∥ F-4 ∥ F-5** |
| 2-10 | F-5 | 포지션 현황 | T-F5 | F-2 (mock) | **F-3 ∥ F-4 ∥ F-5** |

**병렬 슬롯 요약:**

```
Slot A: B-4 ∥ B-5 ∥ B-6       (키움 클라이언트 3종)
Slot B: B-9 ∥ B-14 ∥ B-19     (DB 의존 모듈 3종)
Slot C: B-12                    (뉴스 Redis)
Slot D: F-3 ∥ F-4 ∥ F-5       (Frontend UI 3종)
────────────────────────────────
최대 10개 동시 진행 가능
```

**완료 조건:** 키움 3종 클라이언트 테스트 통과, 기본 API 3개 엔드포인트 동작, Frontend Mock 기반 3개 페이지 렌더링

---

## Sprint 3: 핵심 엔진 + API 확장 (최대 7 병렬)

> Sprint 2 완료 후. 시세 수집, 스캐너, 주문 실행 고도화 + Frontend 확장.

### 병렬 그룹

```
B-4 완료          B-5+B-14 완료      B-2+B-9 완료
    │                  │                  │
    ▼                  ▼                  ▼
   B-7              B-15               B-16
 시세수집          주문실행 고도화      매매내역 API

B-19 완료                             F 시리즈
    │                              ┌──┬──┬──┐
    ▼                              ▼  ▼  ▼
  B-20                            F-6 F-7 F-10
 자동리포트                       실시간 매매내역 리스크
```

| 순서 | ID | 태스크 | TDD 테스트 | 선행 | 병렬 |
|------|-----|--------|-----------|------|------|
| 3-1 | B-7 | Market Data Collector | T-B7 | B-4 | **B-7 ∥ B-15 ∥ B-16 ∥ B-20** |
| 3-2 | B-15 | Order Execution 고도화 | T-B15 | B-5, B-14 | **B-7 ∥ B-15 ∥ B-16 ∥ B-20** |
| 3-3 | B-16 | 매매 내역 API | T-B16 | B-2, B-9 | **B-7 ∥ B-15 ∥ B-16 ∥ B-20** |
| 3-4 | B-20 | 자동 리포트 | T-B20 | B-19 | **B-7 ∥ B-15 ∥ B-16 ∥ B-20** |
| 3-5 | F-6 | 실시간 상태 (WebSocket) | T-F6 | F-2 (mock) | **F-6 ∥ F-7 ∥ F-10** |
| 3-6 | F-7 | 매매 내역 페이지 | T-F7 | F-2 (mock) | **F-6 ∥ F-7 ∥ F-10** |
| 3-7 | F-10 | 리스크 설정 UI | T-F10 | F-2 (mock) | **F-6 ∥ F-7 ∥ F-10** |

**완료 조건:** VWAP/분봉 계산 테스트 통과, 분할매수 테스트 통과, trades API pagination 동작

---

## Sprint 4: 전략 엔진 + 매매 루프 (최대 5 병렬)

> Sprint 3 완료 후. 스캐너, 매매 루프, WebSocket + Frontend 전략 UI.

### 병렬 그룹

```
B-7 완료                B-5+B-7 완료
┌────┐                      │
▼    │                      ▼
B-10 │                     B-8
스캐너│                   매매루프
     │
     │    B-19+B-20 완료
     │        │
     │        ▼
     │      B-22
     │    리포트 API

F 시리즈: F-8 ∥ F-9 ∥ F-11
```

| 순서 | ID | 태스크 | TDD 테스트 | 선행 | 병렬 |
|------|-----|--------|-----------|------|------|
| 4-1 | B-10 | Opening Scanner + Scanner API | T-B10 | B-7 | **B-10 ∥ B-8 ∥ B-22** |
| 4-2 | B-8 | 자동매매 루프 (프레임워크) | T-B8 | B-5, B-7 | **B-10 ∥ B-8 ∥ B-22** |
| 4-3 | B-22 | 리포트/통계 API | T-B22 | B-19, B-20 | **B-10 ∥ B-8 ∥ B-22** |
| 4-4 | F-8 | 전략 설정 페이지 | T-F8 | F-2 (mock) | **F-8 ∥ F-9 ∥ F-11** |
| 4-5 | F-9 | 장초 스캐너 뷰 | T-F9 | F-2 (mock) | **F-8 ∥ F-9 ∥ F-11** |
| 4-6 | F-11 | 주문 모니터링 | T-F11 | F-2 (mock) | **F-8 ∥ F-9 ∥ F-11** |

**B-8 범위 참고:** Sprint 4의 매매 루프는 asyncio 프레임워크(시작/정지/사이클 구조)만 구현한다.
전략 엔진(B-13, Sprint 5)과 스캐너(B-10, 같은 Sprint이지만 병렬)는 아직 통합되지 않으므로,
B-8은 시세 수집 → 주문 실행의 **기본 루프 골격**이며, 전략 통합은 Sprint 5 이후에 완성된다.

**완료 조건:** 거래대금 랭킹 테스트 통과, asyncio 매매 루프 시작/정지, 리포트 API 동작

---

## Sprint 5: 전략 통합 + WebSocket (최대 4 병렬)

> Sprint 4 완료 후. 전략 엔진(스캐너+뉴스 통합), WebSocket, Frontend 차트.

### 병렬 그룹

```
B-10+B-11 완료        B-8 완료
      │                  │
      ▼                  ▼
    B-13               B-18
  전략엔진           WebSocket

F 시리즈: F-12 ∥ F-13 ∥ F-14
```

| 순서 | ID | 태스크 | TDD 테스트 | 선행 | 병렬 |
|------|-----|--------|-----------|------|------|
| 5-1 | B-13 | Strategy Engine | T-B13 | B-10, B-11 | **B-13 ∥ B-18** |
| 5-2 | B-18 | WebSocket 실시간 | T-B18 | B-8 | **B-13 ∥ B-18** |
| 5-3 | F-12 | 성과 분석 차트 | T-F12 | F-2 (mock) | **F-12 ∥ F-13 ∥ F-14** |
| 5-4 | F-13 | 학습 메트릭 | T-F13 | F-2 (mock) | **F-12 ∥ F-13 ∥ F-14** |
| 5-5 | F-14 | 리포트 뷰어 | T-F14 | F-2 (mock) | **F-12 ∥ F-13 ∥ F-14** |

**완료 조건:** 전략 매수 신호 테스트 통과, WebSocket 연결 + 메시지 수신, 차트 렌더링

---

## Sprint 6: 최종 통합 (순차)

> Sprint 5 완료 후. 전략 API + 파라미터 튜닝.

### 순차 그룹

```
B-13 완료
├──→ B-17 (전략 관리 API)
└──→ B-21 (파라미터 튜닝, B-19+B-13)
```

| 순서 | ID | 태스크 | TDD 테스트 | 선행 | 병렬 |
|------|-----|--------|-----------|------|------|
| 6-1 | B-17 | 전략 관리 API | T-B17 | B-13 | **B-17 ∥ B-21** |
| 6-2 | B-21 | 파라미터 튜닝 | T-B21 | B-19, B-13 | **B-17 ∥ B-21** |

**완료 조건:** 전략 on/off API 동작, 파라미터 자동 최적화 테스트 통과

---

# 5. 통합 검증 게이트

Sprint 완료 시점마다 Backend ↔ Frontend 실제 연동 검증을 수행한다.

| 게이트 | 시점 | 검증 항목 |
|--------|------|-----------|
| **Integration-1** | Sprint 3 완료 | Backend API → Frontend 대시보드 실제 데이터 표시 |
| **Integration-2** | Sprint 5 완료 | WebSocket 실시간 업데이트, 전략 신호 → Frontend 반영 |
| **Integration-3** | Sprint 6 완료 | 전체 E2E 매매 사이클, 리포트 생성 → 조회 |

### 통합 테스트 체크리스트

```
Integration-1:
  [ ] GET /api/v1/health → 200
  [ ] GET /api/v1/account/balance → Frontend 대시보드 숫자 일치
  [ ] GET /api/v1/account/positions → Frontend 포지션 리스트 렌더링

Integration-2:
  [ ] WS /ws/live 연결 → Frontend 실시간 상태 업데이트
  [ ] 매매 신호 발생 → WebSocket → Frontend 알림 표시
  [ ] 전략 설정 변경 → API → Backend 반영 확인

Integration-3:
  [ ] 시세수집 → 스캐너 → 전략 → 리스크 → 주문 → DB 기록 (전체 E2E)
  [ ] 일간 리포트 자동 생성 → Frontend 조회
  [ ] 비상 청산 버튼 → API → 전 포지션 청산 확인
```

---

# 6. 병렬 실행 요약 (Gantt 뷰)

```
Sprint      Backend                           Frontend              병렬수
──────────────────────────────────────────────────────────────────────────
  0    │ B-1                              │ F-1 → F-2             │  2
       │                                  │                       │
  1    │ B-2 ∥ B-3 ∥ B-11               │                       │  3
       │                                  │                       │
  2    │ B-4 ∥ B-5 ∥ B-6               │ F-3 ∥ F-4 ∥ F-5     │ 10
       │ B-9 ∥ B-14 ∥ B-19             │                       │
       │ B-12                            │                       │
       │                                  │                       │
  3    │ B-7 ∥ B-15 ∥ B-16 ∥ B-20     │ F-6 ∥ F-7 ∥ F-10    │  7
       │                                  │                       │
  4    │ B-10 ∥ B-8 ∥ B-22             │ F-8 ∥ F-9 ∥ F-11    │  6
       │                                  │                       │
  5    │ B-13 ∥ B-18                    │ F-12 ∥ F-13 ∥ F-14   │  5
       │                                  │                       │
  6    │ B-17 ∥ B-21                    │                       │  2
──────────────────────────────────────────────────────────────────────────
합계   │ 22 태스크                        │ 14 태스크              │
```

---

# 7. 태스크 마스터 테이블

전체 36개 태스크의 완전한 속성 목록.

> **Phase vs Sprint:** Phase는 v1.0 설계서의 기능 분류(MVP/전략/고도화)이고,
> Sprint는 의존성 분석 기반의 최적 실행 순서이다.
> 의존성이 허용하면 Phase 3 태스크(예: B-19)도 Sprint 2에서 조기 착수할 수 있다.

## 7.1 Backend 태스크 (B-1 ~ B-22)

| ID | 태스크 | 모듈 | 선행 | Sprint | 병렬그룹 | TDD 테스트 | Phase |
|----|--------|------|------|--------|---------|-----------|-------|
| B-1 | 프로젝트 초기 셋업 | infra | - | 0 | B-1 ∥ F-1 | T-B1 | 1 |
| B-2 | DB 스키마 + ORM 모델 | models | B-1 | 1 | B-2 ∥ B-3 ∥ B-11 | T-B2 | 1 |
| B-3 | 키움 인증 클라이언트 | kiwoom/auth | B-1 | 1 | B-2 ∥ B-3 ∥ B-11 | T-B3 | 1 |
| B-4 | 키움 시세 클라이언트 | kiwoom/market | B-3 | 2 | B-4 ∥ B-5 ∥ B-6 | T-B4 | 1 |
| B-5 | 키움 주문 클라이언트 | kiwoom/order | B-3 | 2 | B-4 ∥ B-5 ∥ B-6 | T-B5 | 1 |
| B-6 | 키움 계좌 클라이언트 | kiwoom/account | B-3 | 2 | B-4 ∥ B-5 ∥ B-6 | T-B6 | 1 |
| B-7 | Market Data Collector | core/market_data | B-4 | 3 | B-7 ∥ B-15 ∥ B-16 ∥ B-20 | T-B7 | 1 |
| B-8 | 기본 자동매매 루프 | core/trader | B-5, B-7 | 4 | B-10 ∥ B-8 ∥ B-22 | T-B8 | 1 |
| B-9 | FastAPI 기본 API + 시스템 제어 | api | B-2 | 2 | B-9 ∥ B-14 ∥ B-19 | T-B9 | 1 |
| B-10 | Opening Scanner + Scanner API | core/scanner + api/scanner | B-7 | 4 | B-10 ∥ B-8 ∥ B-22 | T-B10 | 2 |
| B-11 | StockNews REST 연동 | core/news_client | B-1 | 1 | B-2 ∥ B-3 ∥ B-11 | T-B11 | 2 |
| B-12 | Redis 뉴스 구독 | core/news_client | B-11 | 2 | 독립 | T-B12 | 2 |
| B-13 | Strategy Engine | core/strategy | B-10, B-11 | 5 | B-13 ∥ B-18 | T-B13 | 2 |
| B-14 | Risk Management + Risk API | core/risk + api/risk | B-2 | 2 | B-9 ∥ B-14 ∥ B-19 | T-B14 | 2 |
| B-15 | Order Execution 고도화 | core/order_executor | B-5, B-14 | 3 | B-7 ∥ B-15 ∥ B-16 ∥ B-20 | T-B15 | 2 |
| B-16 | 매매 내역 API | api/trades | B-2, B-9 | 3 | B-7 ∥ B-15 ∥ B-16 ∥ B-20 | T-B16 | 2 |
| B-17 | 전략 관리 API | api/strategy | B-13 | 6 | B-17 ∥ B-21 | T-B17 | 2 |
| B-18 | WebSocket 실시간 | api/ws | B-8 | 5 | B-13 ∥ B-18 | T-B18 | 2 |
| B-19 | Learning DB | core/learning | B-2 | 2 | B-9 ∥ B-14 ∥ B-19 | T-B19 | 3 |
| B-20 | 자동 리포트 | core/report | B-19 | 3 | B-7 ∥ B-15 ∥ B-16 ∥ B-20 | T-B20 | 3 |
| B-21 | 파라미터 튜닝 | core/tuner | B-19, B-13 | 6 | B-17 ∥ B-21 | T-B21 | 3 |
| B-22 | 리포트/통계 API | api/reports | B-19, B-20 | 4 | B-10 ∥ B-8 ∥ B-22 | T-B22 | 3 |

## 7.2 Frontend 태스크 (F-1 ~ F-14)

| ID | 태스크 | 선행(실제) | Mock 독립 | Sprint | 병렬그룹 | TDD 테스트 | Phase |
|----|--------|-----------|----------|--------|---------|-----------|-------|
| F-1 | 프로젝트 초기 셋업 | - | - | 0 | B-1 ∥ F-1 | T-F1 | 1 |
| F-2 | API 클라이언트 + Mock | F-1 | - | 0 | F-1 → F-2 | T-F2 | 1 |
| F-3 | 인증 UI | F-2 | MSW | 2 | F-3 ∥ F-4 ∥ F-5 | T-F3 | 1 |
| F-4 | 계좌 대시보드 | F-2 | MSW | 2 | F-3 ∥ F-4 ∥ F-5 | T-F4 | 1 |
| F-5 | 포지션 현황 | F-2 | MSW | 2 | F-3 ∥ F-4 ∥ F-5 | T-F5 | 1 |
| F-6 | 실시간 상태 | F-2 | jest-ws-mock | 3 | F-6 ∥ F-7 ∥ F-10 | T-F6 | 1 |
| F-7 | 매매 내역 페이지 | F-2 | MSW | 3 | F-6 ∥ F-7 ∥ F-10 | T-F7 | 2 |
| F-8 | 전략 설정 페이지 | F-2 | MSW | 4 | F-8 ∥ F-9 ∥ F-11 | T-F8 | 2 |
| F-9 | 장초 스캐너 뷰 | F-2 | MSW+WS | 4 | F-8 ∥ F-9 ∥ F-11 | T-F9 | 2 |
| F-10 | 리스크 설정 UI | F-2 | MSW | 3 | F-6 ∥ F-7 ∥ F-10 | T-F10 | 2 |
| F-11 | 주문 모니터링 | F-2 | MSW+WS | 4 | F-8 ∥ F-9 ∥ F-11 | T-F11 | 2 |
| F-12 | 성과 분석 차트 | F-2 | MSW | 5 | F-12 ∥ F-13 ∥ F-14 | T-F12 | 3 |
| F-13 | 학습 메트릭 | F-2 | MSW | 5 | F-12 ∥ F-13 ∥ F-14 | T-F13 | 3 |
| F-14 | 리포트 뷰어 | F-2 | MSW | 5 | F-12 ∥ F-13 ∥ F-14 | T-F14 | 3 |

---

# 8. 크리티컬 패스

순차 실행 시 가장 긴 경로 (병목):

```
경로 A: B-1 → B-3 → B-4 → B-7 → B-10 → B-13 → B-17   (7단계)
         S0     S1    S2    S3     S4      S5     S6

경로 B: B-1 → B-3 → B-4 → B-7 → B-10 → B-13 → B-21   (7단계)
         S0     S1    S2    S3     S4      S5     S6
```

**크리티컬 패스 길이: 7 Sprint (7개 태스크, 경로 A/B 동일)**

경로 A(B-17)와 경로 B(B-21)는 모두 B-13에서 분기하며, 둘 다 Sprint 6에서 완료된다.
이 경로의 태스크가 지연되면 전체 일정에 직접 영향을 미친다.

### 주요 비크리티컬 경로

```
B-1 → B-2 → B-19 → B-20 → B-22  (5단계, 여유 2 Sprint)
B-1 → B-3 → B-5 → B-8 → B-18   (5단계, 여유 2 Sprint)
```

### 리스크 완화

| 크리티컬 태스크 | 리스크 | 완화 방법 |
|----------------|--------|----------|
| B-3 (키움 인증) | 키움 API 스펙 불확실 | Mock 기반 선개발, 실제 API 후연동 |
| B-7 (시세 수집) | 실시간 데이터 복잡도 | REST Polling 우선 구현, WebSocket 후 추가 |
| B-10 (스캐너) | B-7 완료 대기 필수 | B-7과 B-10 설계는 병렬로 선행 가능 |
| B-13 (전략 엔진) | 전략 로직 복잡도 + B-10 대기 | 단순 Rule 기반 우선, ML 후 추가 |

---

# 9. 태스크별 TDD 실행 프로토콜

각 태스크(B-n 또는 F-n) 시작 시 아래 순서를 따른다.

```
┌─────────────────────────────────────────────────────┐
│ Step 1: TestAgent.md에서 T-{ID} 섹션 확인            │
│ Step 2: RED — 실패 테스트 작성                        │
│         pytest tests/unit/... -v (FAIL 확인)         │
│ Step 3: GREEN — 최소 구현 코드 작성                    │
│         pytest tests/unit/... -v (PASS 확인)         │
│ Step 4: REFACTOR — 코드 품질 개선                     │
│         pytest --cov=src -v (커버리지 확인)           │
│ Step 5: 커버리지 게이트 통과 (Backend 80%+)            │
│ Step 6: 태스크 완료 표기                               │
└─────────────────────────────────────────────────────┘
```

### 실행 명령어 요약

```bash
# Backend 단위 테스트 (특정 모듈)
cd backend && pytest tests/unit/kiwoom_client/test_auth.py -v

# Backend 전체 + 커버리지
cd backend && pytest --cov=src --cov-report=term-missing -v

# Frontend 단위 테스트 (특정 컴포넌트)
cd frontend && npm test -- Dashboard.test.tsx

# Frontend 전체 + 커버리지
cd frontend && npm test -- --watchAll=false --coverage

# E2E (통합 게이트 시점)
cd frontend && npx playwright test
```

---

# 10. 진행 추적 체크리스트

## Phase 1: MVP

| Sprint | ID | 태스크 | TDD | 구현 | 검증 |
|--------|-----|--------|-----|------|------|
| 0 | B-1 | Backend 셋업 | [ ] | [ ] | [ ] |
| 0 | F-1 | Frontend 셋업 | [ ] | [ ] | [ ] |
| 0 | F-2 | API Client + Mock | [ ] | [ ] | [ ] |
| 1 | B-2 | DB 모델 | [ ] | [ ] | [ ] |
| 1 | B-3 | 키움 인증 | [ ] | [ ] | [ ] |
| 2 | B-4 | 키움 시세 | [ ] | [ ] | [ ] |
| 2 | B-5 | 키움 주문 | [ ] | [ ] | [ ] |
| 2 | B-6 | 키움 계좌 | [ ] | [ ] | [ ] |
| 2 | B-9 | FastAPI 기본 API + 시스템 제어 | [ ] | [ ] | [ ] |
| 2 | F-3 | 인증 UI | [ ] | [ ] | [ ] |
| 2 | F-4 | 대시보드 | [ ] | [ ] | [ ] |
| 2 | F-5 | 포지션 | [ ] | [ ] | [ ] |
| 3 | B-7 | Market Data | [ ] | [ ] | [ ] |
| 4 | B-8 | 매매 루프 (프레임워크) | [ ] | [ ] | [ ] |
| 3 | F-6 | 실시간 상태 | [ ] | [ ] | [ ] |
| - | **Integration-1** | Backend↔Frontend 연동 | - | - | [ ] |

## Phase 2: 전략 연동

| Sprint | ID | 태스크 | TDD | 구현 | 검증 |
|--------|-----|--------|-----|------|------|
| 1 | B-11 | 뉴스 REST | [ ] | [ ] | [ ] |
| 2 | B-12 | 뉴스 Redis | [ ] | [ ] | [ ] |
| 2 | B-14 | 리스크 관리 + Risk API | [ ] | [ ] | [ ] |
| 4 | B-10 | 스캐너 + Scanner API | [ ] | [ ] | [ ] |
| 5 | B-13 | 전략 엔진 | [ ] | [ ] | [ ] |
| 3 | B-15 | 주문 실행 고도화 | [ ] | [ ] | [ ] |
| 3 | B-16 | 매매 내역 API | [ ] | [ ] | [ ] |
| 6 | B-17 | 전략 관리 API | [ ] | [ ] | [ ] |
| 5 | B-18 | WebSocket | [ ] | [ ] | [ ] |
| 3 | F-7 | 매매 내역 | [ ] | [ ] | [ ] |
| 4 | F-8 | 전략 설정 | [ ] | [ ] | [ ] |
| 4 | F-9 | 스캐너 뷰 | [ ] | [ ] | [ ] |
| 3 | F-10 | 리스크 UI | [ ] | [ ] | [ ] |
| 4 | F-11 | 주문 모니터 | [ ] | [ ] | [ ] |
| - | **Integration-2** | 실시간 + 전략 연동 | - | - | [ ] |

## Phase 3: 고도화

| Sprint | ID | 태스크 | TDD | 구현 | 검증 |
|--------|-----|--------|-----|------|------|
| 2 | B-19 | Learning DB | [ ] | [ ] | [ ] |
| 3 | B-20 | 자동 리포트 | [ ] | [ ] | [ ] |
| 6 | B-21 | 파라미터 튜닝 | [ ] | [ ] | [ ] |
| 4 | B-22 | 리포트 API | [ ] | [ ] | [ ] |
| 5 | F-12 | 성과 차트 | [ ] | [ ] | [ ] |
| 5 | F-13 | 학습 메트릭 | [ ] | [ ] | [ ] |
| 5 | F-14 | 리포트 뷰어 | [ ] | [ ] | [ ] |
| - | **Integration-3** | 전체 E2E | - | - | [ ] |
